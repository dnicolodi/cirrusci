test_template: &test
  test_script:
    - python3 --version
    - git clone https://github.com/dnicolodi/python-siphash24.git
    - cd python-siphash24
    - python3 -m pip install .
    - python3 test.py

macos-arm64_task:
  macos_instance:
    image: ghcr.io/cirruslabs/macos-monterey-xcode:14
  install_script:
    - brew install python@3.10
    - echo "PATH=/opt/homebrew/opt/python@3.10/libexec/bin/:$PATH" >> $CIRRUS_ENV
  fix-pip_script:
    - python3 -m pip install --upgrade git+https://github.com/pypa/pip.git@main
  << : *test

debian-unstable_task:
  container:
    dockerfile: ci/debian-unstable.docker
  fix-pip_script:
    - python3 -m pip install --upgrade git+https://github.com/pypa/pip.git@refs/pull/11623/head
  << : *test

fedora-37_task:
  container:
    dockerfile: ci/fedora-37.docker
  << : *test

archlinux_task:
  container:
    dockerfile: ci/archlinux.docker
  << : *test

manylinux_task:
  container:
    dockerfile: ci/manylinux.docker
  matrix:
    - env:
        py: "cp37-cp37m"
    - env:
        py: "cp311-cp311"
  env:
    PATH: "/opt/python/${py}/bin/:${PATH}"
  << : *test
